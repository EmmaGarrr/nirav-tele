{% extends 'admin/master.html' %}
{% from 'admin/lib.html' import render_field %} {# Flask-Admin might provide this, or use WTForms macros #}

{# If render_field is not available or you prefer WTForms macros: #}

{# If not using Flask-Bootstrap, you'll render fields manually:
<div class="form-group">
    {{ form.username.label(class="form-control-label") }}
    {{ form.username(class="form-control" + (" is-invalid" if form.username.errors else "")) }}
    {% if form.username.errors %}
        <div class="invalid-feedback">
            {% for error in form.username.errors %}<span>{{ error }}</span><br>{% endfor %}
        </div>
    {% endif %}
</div>
#}


{% block body %}
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <a href="{{ url_for('.user_details_view', user_id_str=user_doc._id) }}" class="btn btn-default pull-right" style="margin-bottom: 15px;">
          Â« Back to User Details
        </a>
        <h2>Edit User: <small>{{ user_doc.get('username', 'N/A') }}</small></h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {# --- Using Flask-Bootstrap's wtf.quick_form for simplicity --- #}
        {# --- If you don't have Flask-Bootstrap, render fields manually as commented above --- #}
        {% if form %}
             <form method="POST" action="{{ url_for('.edit_user_view', user_id_str=user_doc._id) }}">
               {{ form.hidden_tag() }} {# IMPORTANT for CSRF protection #}

               <div class="form-group {% if form.username.errors %}has-error is-invalid{% endif %}"> {# Added is-invalid for BS4 #}
                 {{ form.username.label(class="control-label") }}
                 {{ form.username(class="form-control" + (" is-invalid" if form.username.errors else ""), size=30) }}
                 {% if form.username.errors %}
                   <div class="invalid-feedback"> {# BS4 class for errors #}
                       {% for error in form.username.errors %}<span>{{ error }}</span><br>{% endfor %}
                   </div>
                 {% endif %}
               </div>

               <div class="form-group {% if form.email.errors %}has-error is-invalid{% endif %}">
                 {{ form.email.label(class="control-label") }}
                 {{ form.email(class="form-control" + (" is-invalid" if form.email.errors else ""), size=30) }}
                 {% if form.email.errors %}
                   <div class="invalid-feedback">
                       {% for error in form.email.errors %}<span>{{ error }}</span><br>{% endfor %}
                   </div>
                 {% endif %}
               </div>

               <div class="form-group">
                 <div class="form-check"> {# BS4 class for checkbox layout #}
                   {{ form.is_admin(class="form-check-input") }}
                   {{ form.is_admin.label(class="form-check-label") }}
                 </div>
                 {% if form.is_admin.errors %}
                   {# Display errors for checkbox if any (less common for boolean) #}
                   <div class="text-danger small">
                       {% for error in form.is_admin.errors %}{{ error }}<br>{% endfor %}
                   </div>
                 {% endif %}
               </div>

               {{ form.submit(class="btn btn-primary") }}
             </form>
           {% else %}
             <p>Form could not be loaded.</p>
           {% endif %}
      </div>
    </div>
  </div>
{% endblock %}